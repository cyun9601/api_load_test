# STT ëª¨ë¸ ë¡œë“œ í…ŒìŠ¤íŠ¸ ë„êµ¬

STT(Speech-to-Text) ëª¨ë¸ì˜ ì„±ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ Python ë„êµ¬ì…ë‹ˆë‹¤. Cold startë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ warm-up ê¸°ëŠ¥ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.

## ê¸°ëŠ¥

- ğŸ”¥ **Warm-up ìš”ì²­**: Cold startë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì´ˆê¸° Mê°œì˜ ìš”ì²­ì„ ë²„ë¦¬ê³  ì‹¤ì œ ì„±ëŠ¥ ì¸¡ì •ì— ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
- ğŸ“Š **ì„±ëŠ¥ ë©”íŠ¸ë¦­**: í‰ê· , ì¤‘ì•™ê°’, P95, P99 ì‘ë‹µ ì‹œê°„ ë° ì²˜ë¦¬ëŸ‰ ì¸¡ì •
- âš¡ **ë™ì‹œ ìš”ì²­ ì§€ì›**: ì—¬ëŸ¬ ìš”ì²­ì„ ë™ì‹œì— ì²˜ë¦¬í•˜ì—¬ ì‹¤ì œ ë¶€í•˜ ìƒí™©ì„ ì‹œë®¬ë ˆì´ì…˜
- ğŸµ **ëœë¤ ì˜¤ë””ì˜¤ ìƒì„±**: ë§¤ ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ ëœë¤ ì˜¤ë””ì˜¤ë¥¼ ìƒì„±í•˜ì—¬ ìºì‹œ íš¨ê³¼ë¥¼ ë°©ì§€í•˜ê³  ì •í™•í•œ ì„±ëŠ¥ ì¸¡ì •
- ğŸ’¾ **ê²°ê³¼ ì €ì¥**: JSON í˜•ì‹ìœ¼ë¡œ ìƒì„¸í•œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥

## ì„¤ì¹˜

```bash
pip install -e .
```

ë˜ëŠ” í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ì§ì ‘ ì„¤ì¹˜:

```bash
pip install aiohttp openai numpy pyyaml
```

## ì‚¬ìš© ë°©ë²•

### ì„¤ì • íŒŒì¼

í”„ë¡œê·¸ë¨ì€ `config.yaml` íŒŒì¼ì—ì„œ ì„¤ì •ì„ ì½ì–´ì˜µë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ `config.yaml` íŒŒì¼ì„ ì‚¬ìš©í•˜ë©°, `CONFIG_PATH` í™˜ê²½ ë³€ìˆ˜ë¡œ ë‹¤ë¥¸ ê²½ë¡œë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê¸°ë³¸ ì‚¬ìš©

```bash
python stt_test.py
```

### ì„¤ì • íŒŒì¼ ì˜ˆì œ

`config.yaml` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•˜ì„¸ìš”:

```yaml
# í…ŒìŠ¤íŠ¸ ì„¤ì •
total_requests: 100          # ì´ ìš”ì²­ ìˆ˜ (N)
warmup_requests: 10          # Warm-up ìš”ì²­ ìˆ˜ (M) - ì´ ê°œìˆ˜ë§Œí¼ ë²„ë¦¼
concurrent_requests: 5       # ë™ì‹œ ìš”ì²­ ìˆ˜
request_delay: 0.0          # ìš”ì²­ ê°„ ì§€ì—° ì‹œê°„ (ì´ˆ)

# ì˜¤ë””ì˜¤ ì„¤ì •
audio_duration: 10.0        # ìƒì„±í•  ì˜¤ë””ì˜¤ ê¸¸ì´ (ì´ˆ)
sample_rate: 16000          # ì˜¤ë””ì˜¤ ìƒ˜í”Œë§ ë ˆì´íŠ¸ (Hz)

# API ì„¤ì •
api:
  base_url: "http://192.168.73.172:8000"
  endpoint: "/v1/audio/transcriptions"

# ê²°ê³¼ ì €ì¥ ì„¤ì •
save_path: null             # ê²°ê³¼ ì €ì¥ ê²½ë¡œ (nullì´ë©´ ìë™ ìƒì„±)
```

### ë‹¤ë¥¸ ì„¤ì • íŒŒì¼ ì‚¬ìš©

```bash
# í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì • íŒŒì¼ ê²½ë¡œ ì§€ì •
CONFIG_PATH=my_config.yaml python main.py
```

**ì°¸ê³ **: ë§¤ ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ ëœë¤ ì˜¤ë””ì˜¤ê°€ ìƒì„±ë˜ë¯€ë¡œ ìºì‹œ íš¨ê³¼ ì—†ì´ ì •í™•í•œ ì„±ëŠ¥ ì¸¡ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

## ì½”ë“œ ì»¤ìŠ¤í„°ë§ˆì´ì§•

ì‹¤ì œ STT APIë¥¼ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ `main.py`ì˜ `example_openai_whisper_call` ë˜ëŠ” `example_http_stt_call` í•¨ìˆ˜ë¥¼ ì‹¤ì œ API í˜¸ì¶œ í•¨ìˆ˜ë¡œ êµì²´í•˜ì„¸ìš”.

### OpenAI Whisper API ì˜ˆì œ

```python
import io

async def my_whisper_call(audio_data: io.BytesIO):
    from openai import AsyncOpenAI
    
    client = AsyncOpenAI(api_key="your-api-key")
    audio_data.seek(0)  # íŒŒì¼ í¬ì¸í„°ë¥¼ ì²˜ìŒìœ¼ë¡œ
    transcript = await client.audio.transcriptions.create(
        model="whisper-1",
        file=("audio.wav", audio_data, "audio/wav"),
        response_format="json"
    )
    return transcript
```

### HTTP STT API ì˜ˆì œ

```python
import io

async def my_stt_call(audio_data: io.BytesIO):
    import aiohttp
    
    async with aiohttp.ClientSession() as session:
        audio_data.seek(0)  # íŒŒì¼ í¬ì¸í„°ë¥¼ ì²˜ìŒìœ¼ë¡œ
        data = aiohttp.FormData()
        data.add_field('audio', audio_data, filename='audio.wav', content_type='audio/wav')
        async with session.post(
            "https://api.example.com/stt",
            data=data,
            headers={"Authorization": "Bearer your-token"}
        ) as response:
            return await response.json()
```

ê·¸ë¦¬ê³  `main()` í•¨ìˆ˜ì—ì„œ `http_stt_call`ì„ `my_stt_call`ë¡œ êµì²´í•˜ì„¸ìš”:

```python
async def stt_api_wrapper():
    # ë§¤ ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ ëœë¤ ì˜¤ë””ì˜¤ ìƒì„±
    audio_data = generate_random_audio(
        duration_seconds=audio_duration,
        sample_rate=sample_rate
    )
    return await my_stt_call(audio_data)  # ì—¬ê¸°ë¥¼ ë³€ê²½
```

## ì¶œë ¥ ì˜ˆì‹œ

```
ğŸ“ ì„¤ì • íŒŒì¼: config.yaml
ğŸµ ì˜¤ë””ì˜¤ ì„¤ì •: ê¸¸ì´ 10.0ì´ˆ, ìƒ˜í”Œë§ ë ˆì´íŠ¸ 16000Hz
   ë§¤ ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ ëœë¤ ì˜¤ë””ì˜¤ ìƒì„± (ìºì‹œ ë°©ì§€)
ğŸŒ API ì„¤ì •: http://192.168.73.172:8000/v1/audio/transcriptions

ğŸš€ STT ëª¨ë¸ ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘
   ì´ ìš”ì²­ ìˆ˜: 100
   Warm-up ìš”ì²­ ìˆ˜: 10
   ë™ì‹œ ìš”ì²­ ìˆ˜: 5
   ì‹¤ì œ ì¸¡ì • ìš”ì²­ ìˆ˜: 90
   ë§¤ ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ ëœë¤ ì˜¤ë””ì˜¤ ìƒì„±

ğŸ”¥ Warm-up ë‹¨ê³„ (10ê°œ ìš”ì²­)...
   Warm-up ì™„ë£Œ (ì†Œìš” ì‹œê°„: 0.50ì´ˆ)

ğŸ“Š ì„±ëŠ¥ ì¸¡ì • ë‹¨ê³„ (90ê°œ ìš”ì²­)...
============================================================
ğŸ“ˆ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼
============================================================
ì´ ìš”ì²­ ìˆ˜: 90
ì„±ê³µí•œ ìš”ì²­: 90 (100.0%)
ì‹¤íŒ¨í•œ ìš”ì²­: 0 (0.0%)

ì‘ë‹µ ì‹œê°„ í†µê³„:
  í‰ê· : 0.505ì´ˆ
  ì¤‘ì•™ê°’: 0.500ì´ˆ
  ìµœì†Œ: 0.498ì´ˆ
  ìµœëŒ€: 0.520ì´ˆ
  P95: 0.515ì´ˆ
  P99: 0.518ì´ˆ

ì²˜ë¦¬ëŸ‰: 180.00 ìš”ì²­/ì´ˆ
============================================================

ğŸ’¾ ê²°ê³¼ê°€ stt_load_test_results_20240101_120000.jsonì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.
```

## ê²°ê³¼ íŒŒì¼ í˜•ì‹

ê²°ê³¼ëŠ” JSON í˜•ì‹ìœ¼ë¡œ ì €ì¥ë˜ë©° ë‹¤ìŒ ì •ë³´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤:

- í…ŒìŠ¤íŠ¸ ì„¤ì • (ì´ ìš”ì²­ ìˆ˜, warm-up ìš”ì²­ ìˆ˜, ë™ì‹œ ìš”ì²­ ìˆ˜ ë“±)
- ì„±ëŠ¥ ë©”íŠ¸ë¦­ (í‰ê·  ì‘ë‹µ ì‹œê°„, P95, P99 ë“±)
- ê° ìš”ì²­ì˜ ìƒì„¸ ê²°ê³¼ (ì‘ë‹µ ì‹œê°„, ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€, ì—ëŸ¬ ë©”ì‹œì§€)
